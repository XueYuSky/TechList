# 2-VerilogHDL设计基础知识

VerilogHDL是C语言发展而来的，用于描述数字电路行为与结构的计算机语言。

VerilogHDL适用于系统级(System)、算法级(Algorithm)、寄存器传输级(Register Transfer Level,RTL)、门级(Gate)和开关级(Switch)各个层次的设计与描述。

---

# 2.1 初识VerilogHDL

Verilog HDL 的基本单位： 模块(module)

用于描述某种特定功能电路的结构或行为。模块既可以用于描述门电路，也可以用于描述编码器，译码器，数据选择器，寄存器和计数器等中等规模的数字器件，还可以用于描述整个数字系统。

Verilog HDL模块由模块声明、端口类型定义、数据类型定义、功能描述等多个部分构成。

---
``` Verilog
module Counter_Design
(
	//globol clock
	input				clk,	//50MHz 
	input				rst_n,
	
	//user interface
	output	reg	[3:0]	cnt
);

    //----------------------------
    //Counter for 4 bit data
    always@(posedge clk or negedge rst_n)
    begin
        if(!rst_n)
            cnt <= 0;
        else
            cnt <= cnt + 1'b1;
    end
endmodule

```

下面是上述实例的基本结构说明：

``` Verilog
//格式说明  Verilog——2001标准，将端口类型合并在模块声明中进行定义

module 模块名
(
    //----------------------------------------
    //端口列表
    //--------------------
    //输入端口列表
    input 输入端口列表,
    //输出端口列表
    output 输出入端口列表,
    //双向端口列表
    inout 双向端口列表,
);

    //----------------------------------------
    //数据类型定义
    wire [msb:lsb] 线网名,线网名,……;
    reg  [msb:lsb] 变量名,变量名,……;

    //----------------------------------------
    //函数与任务声明
    function [位宽] 函数名;
    ……
    endfunction

    task 任务名;
    ……
    endtask

    //----------------------------------------
    //功能描述
    assign 线网名=函数表达式;    //数据流描述方式
    always/initial 过程语句;    //行为描述方式
    调用模块名 实例名 (端口关联列表)    //结构描述方式

endmodule
```

## 模块主要组成简要说明：
1. 模块声明
2. 端口类型说明
3. 数据类型定义说明
4. 函数与任务说明
5. 功能描述说明

---

# 2.2 Verilog基本元素
基本语法元素： 空白符，注释，数值和字符串，标识符，关键字词等。

保留了C语言的语法特点，例如: 空白符、注释方法与C语言完全相同，标识符区分大小写等。

与C语言的区别： Verilog本质上是用来描述硬件电路的，例如线网/变量的概念/取值以及操作符等。

## 2.2.1 取值集合
线网/变量的四种基本取值： 1、0、x和z。x和z不区分大小写。


## 2.2.2 常量表示
Verilog的常量： 取值不变的量。

分为： 整形常量、实数常量、字符串三种类型。

1. 整形常量

​    定义格式：

    <±>        <位宽>        '        <基数>        [数值]
    ----       --------     ----      ------       --------
     |           |           |          |            |
     |           |           |          |            |
    指定数值    用十进制     格式符     指定数值      整数的值
    的正负      指定数值               的基数        
               的二级制
               位宽

基数用于指定数值的形式。基数符号和含义如下表：

|  基数符号     |  表示的进制     |  合法数值字符    |
| ----         | ----           | ----            |
|  B或b        |  二进制         |  0, 1, x/X, z/Z, ?和_    |
|  O或o        |  八进制         |  0~7,  x/X, z/Z, ?和_    |
|  D或d        |  十进制         |  0~9,  x/X, z/Z, ?和_    |
|  H或h        |  十六进制       |  0~9, A~F, x/X, z/Z, ?和_ |

**实例：**

``` Verilog
4'b1001        // 四位二进制数，值为1001

5'd123         // 十进制数，位宽为5位，值为23

3'b01x         // 三位二进制数，值为01x

12'hz          // 12位二进制数，每位值为z
```

2. 实数型常量

实数型常数用于仿真中。表示延迟量、仿真时间等物理参数。可以用带小数点的十进制数，也可以用科学计数法表示。

``` Verilog
1.0             // 十进制数，

3.1415926       // 十进制数，

123.45e2        // 科学计数法表示，值为 12345

1.2e-1          // 科学计数法表示，值为0.12
```

3. 字符串

字符串定义为双引号内的字符序列，用ASCII码序列表示。每个字表示为一个8位ASCII码。

Verilog中，字符串保存在reg类型的变量中。

**如果复制过程中，字符串位数超出reg变量的位宽，则会自动截取ASCII码序列最左边的数值，低位对齐（右对齐）。如果字符串的位数小于reg变量的位数，则默认用数值0填补变量左边的空位。**

字符串不能分为多行书写。

4. 参数定义语句

Verilog允许使用参数定义语句定义常量，用标识符来代替常量数值，用于指定数据的位宽、定义参量和状态编码等。

定义格式：
```Verilog
parameter   参数名1 = 数值或表达式1, 参数名2 = 数值或表达式2, ……;
localparam  参数名1 = 数值或表达式1, 参数名2 = 数值或表达式2, ……;
```
参数定义语句只能对参数赋值一次，并且等式右边的表达式必须为常量或者常量表达式，即表达式中只能包含数据和已定义的参数。例如：

``` Verilog
parameter MSB = 7,LSB = 0;        // 定义参数 MSB和LSB，值分别为：7和0
parameter DELAY = 10;             // 定义参数 DELAY,值为10
……
reg [MSB:LSB] reg_a;              // 引用参数MSB和LSB定义位宽
and #DELAY (y,a,b)                // 引用参数DELAY定义延时时间
```
说明：

1) parameter/localparam定义的参数是局部的。参数定义语句应写在模块的内部，只对当前模块起作用；
2) parameter具有参数传递功能，在层次电路的设计中，可以将上层模块的数值传递给下层模块的参数，从而能够调整下层模块的结构与规则，而localparam不具有参数传递功能，因此无法通过外部数值来改变已经顶一顶额参数值。

## 2.2.3 标识符与关键字

标识符是定义Verilog语言结构名称的字符串。

标识符基本规定：

1) 由大小写字母、数字、$和_（下划线）组成
2) 以字母或下划线开头，中间可以使用下划线，但不能连续使用下划线，也不能以下划线结束；
3) 长度小于1024;
4) 标识符区分大小写;

**关键词：**

Verilog 预先保留的用于定义语言结构的特殊符号成为关键词。

1. Verilog的关键词都是小写的。
2. 标识符第一个字符不能是$，  “$”专门用来表示系统命令，如系统任务和函数。

Verilog特殊标识符： 转义标识符，"\"开头，空白符（空格、制表符、或换行符）结束的任意字符串序列。

---

# 2.3 数据类型

数据类型用于定义电路中的物理连线和局哟存储功能的数据单元。

数据类型定义的语法格式为：

    <数据类型>   [符号]          <位宽>      <标识符>     [元素数]
    ----       --------         ----      ------       --------
     |           |                |          |            |
     |           |                |          |            |
     定义网络/    指定符号         定义数据    网络/变量名  定义元素个数
     变量子类型   signed/unsigned  的位宽   


数据类型分为：线网类型和变量两大类
详见： Page32

## 2.3.1 线网类型

## 2.3.2 变量类型

变量用于定义具有存储作用的数据单元，由寄存器变量，整形变量，实数型变量，时间变量和实时间变量五种子类型。

## 2.3.3 存储器

由寄存器变量构成的数组。
定义格式：
```Verilog
reg [n-1:0]  存储器名  [m-1:0];
```
[n-1:0]表示每个存储单元的位宽为n,而[m-1:0]表示存储器共有m个存储单元。
例如：
```verilog
reg [9:0] sine_rom [1023:9];   // 每个单元的位宽为10位，共有1024个存储单元
```


## 2.3.4 标量与矢量

标量：位宽为一位的线网/变量称为标量。

矢量：位宽大于一位的线网/变量称为标量。

标量类矢量：可按位或者部分位赋值的矢量。用关键词：scalared表示。相当于多个一位标量的集合。

矢量类矢量：不能按位或者部分位赋值的矢量，用关键词： vectored表示。

```verilog
reg scalared [7:0] Qtmp;
wire vectored [15:0] bus16b;
```

---

# 2.4 运算符与操作符

按功能分为9大类的操作符(运算符)。

参考 Page 35,36页。

---

# 2.5 模块功能的描述方法

Verilog中的模块表示电路实体。主要可以应用：

---- 行为描述方法：描述模块逻辑功能

---- 数据流描述方法： 描述模块逻辑关系

---- 结构描述方法： 描述模块内部器件之间的链接关系

## 2.5.1 行为描述

以过程语句为基本单位。模块可以用一个或者多个过程语句描述其行为特性，但过程语句不能嵌套使用。过程语句有两种形式： 

1. inital语句
2. always语句

3. 语句块(block)定义：

4. 延时控制

用于定义从开始遇到语句到真正执行该语句的等待时间。延时控制只用于仿真，综合时所有延时控制将被忽略。

两种书写形式，常规延时和内嵌延时：

5. 过程赋值语句

过程赋值语句是指在inital/always过程语句内部对变量进行赋值的赋值语句。

语法格式：
```verilog
<变量>  <赋值操作符>  <赋值表达式>
```

赋值操作符分为两类：

阻塞赋值： “=”

非阻塞赋值： “<=”

需要重点注意阻塞赋值和非阻塞赋值的区别，深刻体会两种赋值操作对电路产生的影响： 阻塞式赋值在多条赋值语句赋值时，书写顺序非常关键，结果与书写顺序有关；而非阻塞式赋值在多条赋值语句赋值时，多条赋值语句同时赋值，与语句的顺序无关，这样能够**实现并行操作**。

用以下实例对比体会两种赋值语句的区别：

```verilog


```
**总结：**

两条著名Verilog设计规范：

一般，用过程语句描述组合逻辑时建议使用阻塞赋值，描述时序逻辑时使用非阻塞赋值。

注意：同一个过程语句不能同时使用阻塞式和非阻塞式赋值。当模块中同时包含组合逻辑和时序逻辑时，应将两种逻辑电路分开进行描述，用一个always语句描述组合逻辑，用另一个always语句描述时序逻辑，或者改用连续赋值语句描述组合逻辑。

关于过程赋值与连续赋值的概念：

TODO:待补充

6. 高级程序语句

用于控制代码的流向。

分为： 条件语句、分支语句和循环语句。

## 2.5.2 数据流描述

## 2.5.3 结构描述

## 2.5.4 混合描述方法

## 2.5.5 用户自定义原语

---

# 2.6 层次化设计方法

---

# 2.7 函数与任务

---

# 2.8 编写testbench

---
